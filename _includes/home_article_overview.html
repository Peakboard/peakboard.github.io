<div class="article-overview hidden sm:hidden md:block lg:block xl:block">
    <div class="{% if page.lang != 'cn' %}my-6{% else %}mb-6{% endif %} py-12 px-8 md:px-0 max-w-xl mx-auto">
        <h3 class="font-bold text-4xl text-black">{{ site.language[page.lang].homepage-article-overview-title }}</h3>
        <p class="my-3 text-black">{{ site.language[page.lang].homepage-article-overview-content }}</p>

        <div class="mt-8">
            <div id="bricks" class="bricks">
                {% assign collections = site.collections | sort: 'position' %}
                {% for collection in collections %}
                    {% if collection.label != "posts" %}{% if collection.label != "tutorials" %}
                        {% if collection.title[page.lang] %}
                            <div class="brick w-full lg:w-1/2 xl:w-1/2 overflow-hidden mb-4 pr-2">
                                <div class="flex">
                                    <div class="w-8">{% include svg/{{ collection.icon }} %}</div>
                                    <div class="w-auto"><h3 class="md:ml-4 inline content-center">{{ collection.title[page.lang] }}</h3></div>
                                </div>

                                {% assign used_categories = "" | split: "" %}
                                {% assign articles=site[collection.label] | where:"lang",page.lang %}
                                {% assign sorted_articles = (articles | sort: 'weight') %}

                                {% for article in sorted_articles %}
                                    {% assign parts = article.path | split: "/" %}
                                    {% assign num_parts = article.path | split: "/" | size %}
                                    {% if num_parts == 2 %}
                                        <div class="flex">
                                            <div class="w-8 p-1"></div>
                                            <div class="md:ml-4 w-auto {% if forloop.first %}mt-1{% endif %} {% if forloop.last %}mb-6{% endif %}">
                                                <a class="w-full block py-1 hover:text-orange text-black no-underline" href="{{ article.url | relative_url }}">
                                                    {{ article.title | escape }}
                                                </a>
                                            </div>
                                        </div>

                                    {% else %}
                                        {% assign sub_level = parts[1] %}
                                        {% assign matched = used_categories | where_exp:"item", "item == sub_level" | size %}
                                        {% if matched == 0 %}
                                            {% assign all_articles = site[collection.label] | where: "lang", page.lang %}

                                            <div class="flex">
                                                <div class="w-8"></div>
                                                <div class="md:ml-4 w-auto {% if forloop.first %}mt-1{% endif %} {% if forloop.last %}mb-8{% endif %}">
                                                    <p class="w-full block py-1 ml-8 text-black">
                                                        {{ sub_level | replace: "_", " " | capitalize }}
                                                    </p>
                                                </div>
                                            </div>

                                            {% assign sorted_sub_articles = (all_articles | sort: 'weight' ) %}
                                            {% for art in sorted_sub_articles %}
                                                {% assign parts = art.path | split: "/" %}
                                                {% assign num_parts = art.path | split: "/" | size %}
                                                {% if num_parts == 3 and parts[1] == sub_level %}
                                                    <div class="flex">
                                                        <div class="w-8"></div>
                                                        <div class="md:ml-4 w-auto {% if forloop.first %}mt-3{% endif %} {% if forloop.last %}mb-8{% endif %}">
                                                            <a class="w-full block py-1 ml-8 hover:text-orange text-black no-underline" href="{{ art.url | relative_url }}">
                                                                {{ art.title | escape }}
                                                            </a>
                                                        </div>
                                                    </div>

                                                {% endif %}
                                            {% endfor %}

                                            {% assign used_categories = used_categories | push: sub_level %}
                                        {% endif %}

                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}{% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    (function(w, d) {

        // find minimum value from array
        Array.prototype.min = function() {
            return Math.min.apply({}, this);
        };

        // find maximum value from array
        Array.prototype.max = function() {
            return Math.max.apply({}, this);
        };

        // wall, brick(s) margin, wall padding
        w.bricks = function(wall, gap, pad) {
            gap = gap || 0;
            pad = pad || 0;
            if (typeof wall === "string") {
                wall = d.getElementById(wall);
            }
            function class_a(el, c) {
                return el.classList.add(c);
            }
            function class_r(el, c) {
                return el.classList.remove(c);
            }
            function class_h(el, c) {
                return el.classList.contains(c);
            }
            var bricks = wall.children,
                c = bricks.length,
                wait = false,
                brick, c_h, c_c, c_t, i, j;
            if (!c) return;
            var width = bricks[0].offsetWidth + gap,
                o = wall.getAttribute('style') || "",
                x = d.createElement('div');
            class_a(wall, 'bricks');
            class_a(x, wall.className);
            wall.style.padding = 0;
            wall.style.position = 'relative';
            wall.setAttribute('data-style', o);
            x.style.margin = 0;
            x.style.padding = 0;
            x.style.border = 0;
            x.style.outline = 0;
            x.style.width = 'auto';
            x.style.height = 0;
            x.style.float = 'none';
            x.style.display = 'block';
            x.style.clear = 'both';
            x.style.visibility = 'hidden';
            function apply(first) {
                if (!first && !class_h(wall, 'bricks-ready')) return;
                wall.parentNode.insertBefore(x, wall.nextElementSibling || wall.nextSibling || null);
                c_h = [];
                c_c = Math.floor(x.offsetWidth / width);
                if (x.parentNode) x.parentNode.removeChild(x);
                for (i = 0; i < c_c; ++i) {
                    c_h[i] = 0;
                }
                for (i = 0; i < c; ++i) {
                    brick = bricks[i];
                    if (first) {
                        o = brick.getAttribute('style') || "";
                        brick.setAttribute('data-style', o);
                        brick.style.float = 'none';
                        brick.style.display = 'block';
                        brick.style.position = 'absolute';
                    }
                    for (j = c_c - 1; j > -1; --j) {
                        if (c_h[j] === c_h.min()) {
                            c_t = j;
                        }
                    }
                    brick.style.top = (c_h[c_t] + pad) + 'px';
                    brick.style.left = ((width * c_t) + pad) + 'px';
                    c_h[c_t] += brick.offsetHeight + gap;
                    class_a(brick, 'brick-ready');
                }
                wall.style.width = ((width * c_h.length) - gap + (pad * 2)) + 'px';
                wall.style.height = (c_h.max() - gap + (pad * 2)) + 'px';
                class_a(wall, 'bricks-ready');
            } apply(1);
            w.addEventListener("resize", function() {
                if (wait) w.clearTimeout(wait);
                wait = w.setTimeout(apply, 50);
            }, false);
        };

    })(window, document);

    bricks('bricks', 0, 0);
</script>